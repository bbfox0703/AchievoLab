<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MyOwnGames.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyOwnGames"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="AchievoLab:My Owned Steam Games">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid RowSpacing="8" Padding="12" x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Top CommandBar -->
            <RowDefinition Height="*"/>
            <!-- Center List -->
            <RowDefinition Height="Auto"/>
            <!-- Bottom StatusBar only (Log removed) -->
        </Grid.RowDefinitions>

        <!-- Top: CommandBar -->
        <CommandBar Grid.Row="0"
                         DefaultLabelPosition="Right"
                         IsDynamicOverflowEnabled="True">

            <!-- Left content (search) -->
            <CommandBar.Content>
                <AutoSuggestBox x:Name="KeywordBox"
                                Width="240"
                                PlaceholderText="Keyword search"
                                QuerySubmitted="KeywordBox_QuerySubmitted"
                                TextChanged="KeywordBox_TextChanged">
                    <AutoSuggestBox.QueryIcon>
                        <SymbolIcon Symbol="Find"/>
                    </AutoSuggestBox.QueryIcon>
                </AutoSuggestBox>
            </CommandBar.Content>

            <!-- Right-side commands -->
            <CommandBar.PrimaryCommands>

                <!-- Steam API Key -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="Steam API Key" VerticalAlignment="Center"/>
                        <PasswordBox x:Name="ApiKeyBox"
                                     Width="240"
                                     PasswordChar="*"
                                     PlaceholderText="Your Steam Web API Key"
                                     IsPasswordRevealButtonEnabled="True"
                                     PasswordChanged="InputFields_PasswordChanged"/>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- SteamID_64 -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="SteamID_64" VerticalAlignment="Center"/>
                        <PasswordBox x:Name="SteamIdBox"
                                     Width="180"
                                     PasswordChar="*"
                                     PlaceholderText="7656119xxxxxxxxxx"
                                     IsPasswordRevealButtonEnabled="True"
                                     InputScope="Number"
                                     PasswordChanged="InputFields_PasswordChanged"/>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- Language Selection -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="Language" VerticalAlignment="Center"/>
                        <ComboBox x:Name="LanguageComboBox"
                                  Width="120"
                                  SelectionChanged="LanguageComboBox_SelectionChanged">
                            <ComboBoxItem Content="english"/>
                            <ComboBoxItem Content="tchinese"/>
                            <ComboBoxItem Content="japanese"/>
                            <ComboBoxItem Content="arabic"/>
                            <ComboBoxItem Content="brazilian"/>
                            <ComboBoxItem Content="bulgarian"/>
                            <ComboBoxItem Content="czech"/>
                            <ComboBoxItem Content="danish"/>
                            <ComboBoxItem Content="dutch"/>
                            <ComboBoxItem Content="finnish"/>
                            <ComboBoxItem Content="french"/>
                            <ComboBoxItem Content="german"/>
                            <ComboBoxItem Content="greek"/>
                            <ComboBoxItem Content="hungarian"/>
                            <ComboBoxItem Content="indonesian"/>
                            <ComboBoxItem Content="italian"/>
                            <ComboBoxItem Content="korean"/>
                            <ComboBoxItem Content="latam"/>
                            <ComboBoxItem Content="norwegian"/>
                            <ComboBoxItem Content="polish"/>
                            <ComboBoxItem Content="portuguese"/>
                            <ComboBoxItem Content="romanian"/>
                            <ComboBoxItem Content="russian"/>
                            <ComboBoxItem Content="schinese"/>
                            <ComboBoxItem Content="spanish"/>
                            <ComboBoxItem Content="swedish"/>
                            <ComboBoxItem Content="thai"/>
                            <ComboBoxItem Content="turkish"/>
                            <ComboBoxItem Content="ukrainian"/>
                            <ComboBoxItem Content="vietnamese"/>
                        </ComboBox>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- Get Game list -->
                <AppBarButton x:Name="GetGamesButton"
                                   Icon="Download"
                                   Label="Get Game list"
                                   Click="GetGamesButton_Click"
                                   IsEnabled="False"/>
                
                <!-- Stop Button -->
                <AppBarButton x:Name="StopButton"
                                   Icon="Stop"
                                   Label="Stop"
                                   Click="StopButton_Click"
                                   IsEnabled="False"/>
            </CommandBar.PrimaryCommands>
        </CommandBar>

        <!-- Center: GridView (Tile-based like AnSAM) -->
        <GridView Grid.Row="1"
                  x:Name="GamesGridView"
                  ItemsSource="{Binding GameItems}"
                  SelectionMode="None"
                  IsItemClickEnabled="False"
                  IsTabStop="False"
                  DoubleTapped="GamesGridView_DoubleTapped"
                  ContainerContentChanging="GamesGridView_ContainerContentChanging"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                  ScrollViewer.HorizontalScrollMode="Disabled">
            
            <!-- Tile template -->
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="local:GameEntry">
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="8"
                            Width="180"
                            Height="180">
                        <ToolTipService.ToolTip>
                            <TextBlock Text="{x:Bind NameEn, Mode=OneWay}" TextWrapping="Wrap"/>
                        </ToolTipService.ToolTip>
                        
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="80"/>
                                <!-- Image area -->
                                <RowDefinition Height="*"/>
                                <!-- Text area (now has more space) -->
                            </Grid.RowDefinitions>
                            
                            <!-- Game image -->
                            <Border Grid.Row="0" 
                                    Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
                                    CornerRadius="2">
                                <Image Source="{x:Bind IconUri, Mode=OneWay}" 
                                       Stretch="UniformToFill"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                            </Border>
                            
                            <!-- Game info -->
                            <StackPanel Grid.Row="1" 
                                        Margin="0,4,0,0"
                                        Spacing="2">
                                <!-- Game ID -->
                                <TextBlock Text="{x:Bind AppId}" 
                                           FontSize="10"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Left"/>
                                
                                <!-- Game name (localized, 2-4 lines) -->
                                <TextBlock Text="{x:Bind DisplayName, Mode=OneWay}" 
                                           FontSize="12"
                                           FontWeight="Medium"
                                           TextWrapping="Wrap"
                                           MaxLines="3"
                                           LineHeight="14"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Top"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </GridView.ItemTemplate>
            
            <!-- Tile container styling -->
            <GridView.ItemContainerStyle>
                <Style TargetType="GridViewItem">
                    <Setter Property="Margin" Value="4"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                </Style>
            </GridView.ItemContainerStyle>
            
            <!-- Responsive wrapping panel -->
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid Orientation="Horizontal" 
                                   ItemWidth="188" 
                                   ItemHeight="188"/>
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
        </GridView>

        <!-- Bottom: StatusBar only (Log removed) -->
        <Border Grid.Row="2" Padding="10,6" BorderThickness="1,1,0,0" CornerRadius="6"
                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="260"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>

                <TextBlock x:Name="StatusCdn" Grid.Column="1"
                           Text="" VerticalAlignment="Center"
                           Margin="0,0,12,0" FontSize="11" Opacity="0.8"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                    <ProgressBar Width="200"
                                 IsIndeterminate="{Binding IsLoading}"
                                 Minimum="0" Maximum="100"
                                 Value="{Binding ProgressValue}"
                                 Visibility="{Binding ProgressVisibility}"/>
                    <TextBlock Text="{Binding ProgressPercentText}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>
</Window>
