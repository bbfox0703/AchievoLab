<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MyOwnGames.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyOwnGames"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="AchievoLab:My Owned Steam Games">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid RowSpacing="8" Padding="12" x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Top CommandBar -->
            <RowDefinition Height="*"/>
            <!-- Center List -->
            <RowDefinition Height="Auto" MinHeight="200"/>
            <!-- Bottom StatusBar + Logs -->
        </Grid.RowDefinitions>

        <!-- Top: CommandBar -->
        <CommandBar Grid.Row="0"
                         DefaultLabelPosition="Right"
                         IsDynamicOverflowEnabled="True">

            <!-- Left content (search) -->
            <CommandBar.Content>
                <AutoSuggestBox x:Name="KeywordBox"
                                Width="320"
                                PlaceholderText="Keyword search"
                                QuerySubmitted="KeywordBox_QuerySubmitted"
                                TextChanged="KeywordBox_TextChanged">
                    <AutoSuggestBox.QueryIcon>
                        <SymbolIcon Symbol="Find"/>
                    </AutoSuggestBox.QueryIcon>
                </AutoSuggestBox>
            </CommandBar.Content>

            <!-- Right-side commands -->
            <CommandBar.PrimaryCommands>

                <!-- Steam API Key -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="Steam API Key" VerticalAlignment="Center"/>
                        <PasswordBox x:Name="ApiKeyBox"
                                     Width="340"
                                     PasswordChar="*"
                                     PlaceholderText="Your Steam Web API Key"
                                     IsPasswordRevealButtonEnabled="True"/>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- SteamID_64 -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="SteamID_64" VerticalAlignment="Center"/>
                        <PasswordBox x:Name="SteamIdBox"
                                     Width="260"
                                     PasswordChar="*"
                                     PlaceholderText="7656119xxxxxxxxxx"
                                     IsPasswordRevealButtonEnabled="True"
                                     InputScope="Number"/>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- Language Selection -->
                <AppBarElementContainer>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="Language" VerticalAlignment="Center"/>
                        <ComboBox x:Name="LanguageComboBox"
                                  Width="120"
                                  SelectedIndex="1">
                            <ComboBoxItem Content="english"/>
                            <ComboBoxItem Content="tchinese"/>
                            <ComboBoxItem Content="japanese"/>
                            <ComboBoxItem Content="arabic"/>
                            <ComboBoxItem Content="brazilian"/>
                            <ComboBoxItem Content="bulgarian"/>
                            <ComboBoxItem Content="czech"/>
                            <ComboBoxItem Content="danish"/>
                            <ComboBoxItem Content="dutch"/>
                            <ComboBoxItem Content="finnish"/>
                            <ComboBoxItem Content="french"/>
                            <ComboBoxItem Content="german"/>
                            <ComboBoxItem Content="greek"/>
                            <ComboBoxItem Content="hungarian"/>
                            <ComboBoxItem Content="indonesian"/>
                            <ComboBoxItem Content="italian"/>
                            <ComboBoxItem Content="koreana"/>
                            <ComboBoxItem Content="latam"/>
                            <ComboBoxItem Content="norwegian"/>
                            <ComboBoxItem Content="polish"/>
                            <ComboBoxItem Content="portuguese"/>
                            <ComboBoxItem Content="romanian"/>
                            <ComboBoxItem Content="russian"/>
                            <ComboBoxItem Content="schinese"/>
                            <ComboBoxItem Content="spanish"/>
                            <ComboBoxItem Content="swedish"/>
                            <ComboBoxItem Content="thai"/>
                            <ComboBoxItem Content="turkish"/>
                            <ComboBoxItem Content="ukrainian"/>
                            <ComboBoxItem Content="vietnamese"/>
                        </ComboBox>
                    </StackPanel>
                </AppBarElementContainer>

                <!-- Get Game list -->
                <AppBarButton x:Name="GetGamesButton"
                                   Icon="Download"
                                   Label="Get Game list"
                                   Click="GetGamesButton_Click"/>
            </CommandBar.PrimaryCommands>
        </CommandBar>

        <!-- Center: ListView (Details-like) -->
        <ListView Grid.Row="1"
                  x:Name="GamesListView"
                  ItemsSource="{Binding GameItems}"
                  SelectionMode="None">
            <!-- Header row (column titles) -->
            <ListView.Header>
                <Grid Padding="8,6" ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="110"/>
                        <!-- AppID -->
                        <ColumnDefinition Width="56"/>
                        <!-- Icon -->
                        <ColumnDefinition Width="3*"/>
                        <!-- English name -->
                        <ColumnDefinition Width="3*"/>
                        <!-- OS locale name -->
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="AppID" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="1" Text="Game icon" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="2" Text="English game name" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="3" Text="OS Locale game name" FontWeight="SemiBold"/>
                </Grid>
            </ListView.Header>

            <!-- Item row -->
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:GameEntry">
                    <Grid Padding="8,6" ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="110"/>
                            <ColumnDefinition Width="56"/>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="3*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{x:Bind AppId}"/>

                        <Grid Grid.Column="1" Width="40" Height="40">
                            <Image Source="{x:Bind IconUri}" Stretch="Uniform"/>
                        </Grid>

                        <TextBlock Grid.Column="2"
                                   Text="{x:Bind NameEn}"
                                   TextTrimming="CharacterEllipsis"/>

                        <TextBlock Grid.Column="3"
                                   Text="{x:Bind NameLocalized}"
                                   TextTrimming="CharacterEllipsis"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>

            <!-- Simple row styling -->
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>

            <!-- Virtualization -->
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsStackPanel/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
        </ListView>

        <!-- Bottom: StatusBar and Log -->
        <Border Grid.Row="2" Padding="10,6" BorderThickness="1,1,0,0" CornerRadius="6"
                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="260"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                        <ProgressBar Width="200"
                                     IsIndeterminate="{Binding IsLoading}"
                                     Minimum="0" Maximum="100"
                                     Value="{Binding ProgressValue}"
                                     Visibility="{Binding ProgressVisibility}"/>
                        <TextBlock Text="{Binding ProgressPercentText}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
                <ListView x:Name="LogList" Grid.Row="1" ItemsSource="{Binding LogEntries}"/>
            </Grid>
        </Border>

    </Grid>
</Window>
